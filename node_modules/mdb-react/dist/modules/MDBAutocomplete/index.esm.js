import e,{useRef as t,useState as a,useEffect as n,useCallback as r}from"react";import l from"clsx";import{usePopper as o}from"react-popper";import{flip as i}from"@popperjs/core";import c from"react-dom";var s=function(){return s=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function u(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a}var d=function(o){var i,c=o.className,d=o.size,f=o.contrast,m=o.value,p=o.defaultValue,v=o.id,h=o.labelId,g=o.labelClass,y=o.wrapperClass,b=o.wrapperStyle,w=o.wrapperTag,E=o.label,N=o.onChange,C=o.children,k=o.labelRef,O=o.labelStyle,T=o.inputRef,R=o.textarea,x=o.validation,P=o.invalid,V=o.validationTooltip,S=o.btnClasses,F=o.btnOnClick,I=o.btnRef,j=o.type,H=o.onBlur,L=o.readonly,q=o.btn,z=o.btnType,A=u(o,["className","size","contrast","value","defaultValue","id","labelId","labelClass","wrapperClass","wrapperStyle","wrapperTag","label","onChange","children","labelRef","labelStyle","inputRef","textarea","validation","invalid","validationTooltip","btnClasses","btnOnClick","btnRef","type","onBlur","readonly","btn","btnType"]),B=t(null),D=t(null),W=t(null),U=t(null),K=k||B,G=I||D,J=T||(R?U:W),M=a(m||p),Q=M[0],X=M[1],Y=a(0),Z=Y[0],$=Y[1],_=a(void 0!==m&&m.length>0||(void 0!==p&&p.length)>0),ee=_[0],te=_[1],ae=l("form-outline",f&&"form-white",y),ne=l("form-control",ee&&"active","date"===j&&"active",d&&"form-control-".concat(d),c),re=l("form-label",g),le=l(x&&(P?"invalid-".concat(V?"tooltip":"feedback"):"valid-".concat(V?"tooltip":"feedback")));n((function(){var e;K.current&&0!==(null===(e=K.current)||void 0===e?void 0:e.clientWidth)&&$(.8*K.current.clientWidth+8)}),[K,null===(i=K.current)||void 0===i?void 0:i.clientWidth]);var oe=function(){K.current&&$(.8*K.current.clientWidth+8)};n((function(){void 0!==m&&(m.length>0?te(!0):te(!1))}),[m]),n((function(){void 0!==p&&(p.length>0?te(!0):te(!1))}),[p]);var ie=function(e){X(e.currentTarget.value),N&&N(e)},ce=r((function(e){void 0!==Q&&Q.length>0||void 0!==m&&m.length>0?te(!0):te(!1),H&&H(e)}),[Q,m,H]);return e.createElement(w,{className:ae,style:s({},b)},R?e.createElement("textarea",s({readOnly:L,className:ne,onBlur:ce,onChange:ie,onFocus:oe,defaultValue:p,value:m,id:v,ref:J},A)):e.createElement("input",s({type:j,readOnly:L,className:ne,onBlur:ce,onChange:ie,onFocus:oe,value:m,defaultValue:p,id:v,ref:J},A)),E&&e.createElement("label",{className:re,style:O,id:h,htmlFor:v,ref:K},E),x&&e.createElement("div",{className:le},x),e.createElement("div",{className:"form-notch"},e.createElement("div",{className:"form-notch-leading"}),e.createElement("div",{className:"form-notch-middle",style:{width:Z}}),e.createElement("div",{className:"form-notch-trailing"})),q&&e.createElement("button",{ref:G,type:z,className:S,onClick:F},q),C)};d.defaultProps={wrapperTag:"div",btnType:"button",readonly:!1};var f=e.forwardRef((function(t,a){var n=t.className,r=t.show,o=t.tag,i=t.children,c=u(t,["className","show","tag","children"]),d=l("autocomplete-dropdown",r&&"open",n);return e.createElement(o,s({className:d,ref:a},c),i)}));f.defaultProps={tag:"div"};var m=e.forwardRef((function(t,a){var n=t.className,r=t.tag,o=t.children,i=u(t,["className","tag","children"]),c=l("autocomplete-items-list",n);return e.createElement(r,s({className:c,ref:a},i),o)}));m.defaultProps={tag:"ul"};var p=e.forwardRef((function(t,a){var n=t.className,r=t.activeItem,o=t.tag,i=t.children,c=u(t,["className","activeItem","tag","children"]),d=l("autocomplete-item",r&&"active",n);return e.createElement(o,s({className:d,ref:a},c),i)}));p.defaultProps={tag:"li"};var v=function(t){var l=t.className,v=t.displayValue,h=t.dataFilter,g=t.options,y=t.threshold,b=t.itemContent,w=t.getFilteredData,E=t.listHeight,N=t.inputValue,C=t.noResults,k=t.setInputValue,O=t.tag,T=t.customContent,R=t.validation,x=t.required,P=u(t,["className","displayValue","dataFilter","options","threshold","itemContent","getFilteredData","listHeight","inputValue","noResults","setInputValue","tag","customContent","validation","required"]),V=a(!1),S=V[0],F=V[1],I=a(!1),j=I[0],H=I[1],L=a(),q=L[0],z=L[1],A=a(),B=A[0],D=A[1],W=a(),U=W[0],K=W[1],G=a(-1),J=G[0],M=G[1],Q=a([]),X=Q[0],Y=Q[1],Z=a(!1),$=Z[0],_=Z[1],ee=o(B,U,s({placement:"bottom-start",modifiers:[i]},g)),te=ee.styles,ae=ee.attributes;n((function(){var e;if(S){var t=h(N);(e=t)&&"function"==typeof e.then?(_(!0),t.then((function(e){Y(e),_(!1)}))):Y(t)}}),[N,h,S]),n((function(){w&&w(X)}),[w,X]);var ne=r((function(e){var t=B===e.target,a=e.target===U,n=U&&U.contains(e.target);t||a||n||H(!1)}),[B,U]),re=r((function(){if(B){var e=window.getComputedStyle(B).getPropertyValue("width");z(e)}}),[B]);n((function(){if(J>-1){var e=null==U?void 0:U.querySelector("ul");if(e){var t=e.offsetHeight,a=null==U?void 0:U.querySelectorAll("li");if(a){var n=a[J].offsetHeight,r=e.scrollTop,l=J*n,o=l+n>r+t,i=l<r;e.scrollTop=i?l:o?l-t+n:r}}}}),[J,U]);var le=r((function(e){if(S){var t=e.key;if("Escape"===t||"ArrowUp"===t&&e.altKey||"Tab"===t)return H(!1),void(B&&B.focus());switch(t){case"ArrowDown":J<X.length-1&&M(J+1);break;case"ArrowUp":J>0&&M(J-1);break;case"Home":M(0);break;case"End":M(X.length-1);break;case"Enter":if(J>-1){var a=X[J];k(v?v(a):a),H(!1)}return;default:return}e.preventDefault()}}),[J,X,B,k,S,v]);return n((function(){return window.addEventListener("click",ne),window.addEventListener("resize",re),window.addEventListener("keydown",le),function(){window.removeEventListener("click",ne),window.removeEventListener("resize",re),window.removeEventListener("keydown",le)}}),[ne,re,le]),n((function(){S&&(M(-1),setTimeout((function(){H(!0)}),100))}),[S]),n((function(){j||setTimeout((function(){F(!1)}),100)}),[j]),n((function(){if(B){var e=window.getComputedStyle(B).width;z(e)}}),[B,S]),e.createElement(e.Fragment,null,e.createElement(d,s({value:N,onChange:function(e){F(!0),M(-1),k(e.target.value)},onFocus:function(){return F(!0)},className:l,inputRef:D,required:x,validation:R},P),$&&e.createElement("div",{className:"autocomplete-loader spinner-border"},e.createElement("span",{className:"sr-only"},"Loading..."))),S&&void 0!==y&&void 0!==N&&N.length>=y&&c.createPortal(e.createElement(O,s({className:"autocomplete-dropdown-container",ref:K,style:s(s({position:"absolute",zIndex:1065},te.popper),{width:q})},ae.popper),e.createElement(f,{show:j},e.createElement(m,{role:"listbox",style:{maxHeight:"".concat(E,"px")}},0===X.length?e.createElement(p,{role:"option"},C):X.map((function(t,a){return e.createElement(p,{activeItem:J===a,key:v?v(t)+a:t+a,onClick:function(){null==B||B.focus(),k(v?v(t):t),H(!1)},role:"option"},b?b(t):v?v(t):t)}))),T&&T)),document.body))};v.defaultProps={tag:"div",threshold:0,noResults:"No results found",listHeight:190};export{v as default};
